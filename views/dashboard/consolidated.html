{% extends 'layout.html' %}

{% block head %}

<title>Outbound Consolidation - eInvoice Portal</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<link href="/assets/css/pages/inbound/card.css" rel="stylesheet">
<link href="/assets/css/pages/inbound/notice.css" rel="stylesheet">

<link href="/assets/css/pages/profile.css" rel="stylesheet">

<link href="/assets/css/pages/inbound/validation-modal.css" rel="stylesheet">
<link href="/assets/css/pages/inbound/inbound-modal.css" rel="stylesheet">
<!-- Template Main CSS Files -->
<link href="/assets/css/pages/outbound/outbound-table.css" rel="stylesheet">

<script src="/assets/js/config/validation-translations.js"></script>

<style>

     /* Tutorial Modal Styles */
     .tutorial-content {
        position: relative;
    }
    
    .tutorial-progress {
        padding: 15px 15px 5px;
        background-color: #f8f9fa;
    }
    
    .step-indicators {
        margin-top: 10px;
    }
    
    .step-dot {
        width: 12px;
        height: 12px;
        background-color: #dee2e6;
        border-radius: 50%;
        display: inline-block;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .step-dot.active {
        background-color: #0d6efd;
        transform: scale(1.2);
    }
    
    .tutorial-step {
        display: none;
    }
    
    .tutorial-step.active {
        display: block;
    }
    
    .step-content {
        min-height: 300px;
        max-height: 60vh;
        overflow-y: auto;
    }
    
    .step-image img {
        max-height: 200px;
        object-fit: contain;
        border: 1px solid #dee2e6;
    }
    
    /* Highlight elements during tutorial */
    .tutorial-highlight {
        position: relative;
        z-index: 1060;
        box-shadow: 0 0 0 4px rgba(13, 110, 253, 0.5), 0 0 15px rgba(0, 0, 0, 0.3) !important;
        border-radius: 4px;
        transition: box-shadow 0.3s ease;
    }
    
    /* Tutorial tip styles */
    .tutorial-tip {
        background-color: #e7f5ff;
        border-left: 4px solid #0d6efd;
        padding: 15px;
        margin: 15px 0;
        border-radius: 4px;
    }
    
    .tutorial-note {
        background-color: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 15px;
        margin: 15px 0;
        border-radius: 4px;
    }
    
    /* Modal header styling */
    #tutorialModal .modal-header {
        background: linear-gradient(135deg, #0d6efd, #0a58ca);
    }
    
    /* Progress bar styling */
    #tutorialModal .progress {
        height: 8px;
        border-radius: 4px;
        background-color: #e9ecef;
    }
    
    #tutorialModal .progress-bar {
        background: linear-gradient(90deg, #0d6efd, #0a58ca);
        transition: width 0.5s ease;
    }

    /* Guided Tour Styles */
    .guided-tour-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.2) !important;
        backdrop-filter: blur(1px);
        z-index: 1050;
        display: none;
    }
    
    /* Prevent scrolling during tutorial */
    body.tour-active {
        overflow: hidden !important;
        position: fixed;
        width: 100%;
        height: 100%;
    }
    
    .guided-tour-tooltip {
        position: fixed;
        width: min(360px, 90vw);
        background-color: #fff;
        border-radius: 16px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        z-index: 1060;
        display: none;
        overflow: hidden;
        transition: all 0.3s ease;
        --arrow-position: 50%;
        max-height: min(600px, 90vh);
        display: flex;
        flex-direction: column;
    }
    
    /* Header styling */
    .tooltip-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 20px;
        background-color: #f8f9fa;
        border-bottom: 1px solid #eee;
        position: sticky;
        top: 0;
        z-index: 3;
        flex-shrink: 0;
    }
    
    .tooltip-step-indicator {
        font-size: 14px;
        font-weight: 600;
        color: #0d6efd;
        background-color: rgba(13, 110, 253, 0.1);
        padding: 4px 12px;
        border-radius: 20px;
    }
    
    .tooltip-close-btn {
        background: none;
        border: none;
        color: #6c757d;
        font-size: 20px;
        cursor: pointer;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        transition: all 0.2s;
    }
    
    .tooltip-close-btn:hover {
        background-color: rgba(108, 117, 125, 0.1);
        color: #495057;
    }
    
    /* Body styling */
    .tooltip-body {
        padding: 20px;
        overflow-y: auto;
        flex-grow: 1;
        min-height: 100px;
        max-height: calc(90vh - 180px);
    }
    
    .tooltip-title {
        font-size: clamp(16px, 4vw, 18px);
        font-weight: 600;
        color: #212529;
        margin-bottom: 16px;
    }
    
    .tooltip-content {
        font-size: clamp(13px, 3.5vw, 14px);
        line-height: 1.6;
        color: #495057;
    }
    
    .tooltip-content p {
        margin-bottom: 12px;
    }
    
    .tooltip-content ul, .tooltip-content ol {
        padding-left: 20px;
        margin-bottom: 12px;
    }
    
    .tooltip-content li {
        margin-bottom: 6px;
    }
    
    /* Progress styling */
    .tooltip-progress {
        padding: 12px 20px;
        background: #fff;
        border-top: 1px solid #eee;
        position: sticky;
        bottom: 56px;
        z-index: 3;
        flex-shrink: 0;
    }
    
    .tooltip-progress .progress {
        height: 4px;
        border-radius: 2px;
        background-color: #e9ecef;
        margin-bottom: 12px;
        overflow: hidden;
    }
    
    .tooltip-progress .progress-bar {
        background: linear-gradient(90deg, #0d6efd, #6610f2);
        transition: width 0.5s ease;
    }
    
    .step-dot {
        width: 8px;
        height: 8px;
        background-color: #dee2e6;
        border-radius: 50%;
        display: inline-block;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .step-dot.active {
        background-color: #0d6efd;
        transform: scale(1.3);
    }
    
    /* Footer styling */
    .tooltip-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 20px;
        background-color: #f8f9fa;
        border-top: 1px solid #eee;
        position: sticky;
        bottom: 0;
        z-index: 3;
        flex-shrink: 0;
        height: 56px;
    }
    
    .tooltip-btn {
        border: none;
        background: none;
        padding: 8px 16px;
        border-radius: 8px;
        font-size: clamp(12px, 3.5vw, 14px);
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        white-space: nowrap;
        min-width: 70px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
    }
    
    .tooltip-btn-prev {
        color: #6c757d;
        background-color: #f8f9fa;
    }
    
    .tooltip-btn-prev:hover:not(:disabled) {
        background-color: #e9ecef;
    }
    
    .tooltip-btn-prev:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    .tooltip-btn-skip {
        color: #dc3545;
        background-color: #fff;
        border: 1px solid #dc3545;
    }
    
    .tooltip-btn-skip:hover {
        background-color: #dc3545;
        color: #fff;
    }
    
    .tooltip-btn-next {
        color: #fff;
        background-color: #0d6efd;
        border-radius: 8px;
        padding: 8px 20px;
        min-width: 80px;
    }
    
    .tooltip-btn-next:hover {
        background-color: #0b5ed7;
    }
    
    /* Highlight elements during tutorial */
    .tour-highlight {
        position: relative !important;
        z-index: 1055 !important;
        background-color: #ffffff !important;
        box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.4),
                   0 0 15px 5px rgba(13, 110, 253, 0.2) !important;
        border-radius: 4px !important;
        animation: glow-highlight 2s infinite !important;
        isolation: isolate;
    }
    
    /* Row highlighting for table rows */
    .tour-highlight-row {
        position: relative !important;
        z-index: 1054 !important;
        background-color: rgba(13, 110, 253, 0.04) !important;
    }
    
    /* Special handling for table cells */
    .outbound-table td.tour-highlight,
    .outbound-table th.tour-highlight {
        position: relative !important;
        z-index: 1056 !important;
        background-color: rgba(255, 255, 255, 0.98) !important;
        animation: glow-highlight 2s infinite;
    }
    
    /* Special handling for action buttons */
    .tour-highlight .outbound-action-btn {
        position: relative !important;
        z-index: 1057 !important;
        animation: glow-highlight 2s infinite;
    }
    
    /* Special handling for checkboxes */
    .tour-highlight .outbound-checkbox {
        position: relative !important;
        z-index: 1057 !important;
        animation: glow-highlight 2s infinite;
    }
    
/* Enhanced UI Styles */
.statistics-section .card,
.quick-actions-section .card,
.enhanced-filter-section .card,
.document-preview-section .card {
    border: none;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.statistics-section .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.quick-actions-section .btn {
    transition: all 0.2s ease;
    border: none;
    padding: 0.5rem 1rem;
}

.quick-actions-section .btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.enhanced-filter-section .form-floating > .form-control,
.enhanced-filter-section .form-floating > .form-select {
    border-radius: 6px;
    border: 1px solid #dee2e6;
    padding: 1rem 0.75rem;
}

.enhanced-filter-section .form-floating > label {
    padding: 1rem 0.75rem;
}

.document-preview-section .document-info {
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 6px;
}

.document-preview-section .info-item {
    padding: 0.5rem 0;
    border-bottom: 1px solid #dee2e6;
}

.document-preview-section .info-item:last-child {
    border-bottom: none;
}

.document-preview-frame {
    min-height: 300px;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    overflow: hidden;
}

/* Animation for refresh icon */
.spin {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* Chart container styles */
.statistics-section canvas {
    max-height: 200px;
}

/* Card title styles */
.card-title {
    color: #495057;
    font-size: 0.875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Quick action button styles */
.quick-actions-section .btn i {
    font-size: 1rem;
}

/* Enhanced filter styles */
.enhanced-filter-section .btn-link {
    color: #6c757d;
    text-decoration: none;
}

.enhanced-filter-section .btn-link:hover {
    color: #495057;
}

/* Document preview styles */
.document-preview-section .badge {
    padding: 0.5em 0.75em;
    font-weight: 500;
}

.document-preview-section .fw-medium {
    font-weight: 500;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .statistics-section .card {
        margin-bottom: 1rem;
    }
    
    .quick-actions-section .btn {
        width: 100%;
        margin-bottom: 0.5rem;
    }
    
    .enhanced-filter-section .form-floating {
        margin-bottom: 1rem;
    }
}

/* Filter Styles */
.filter-container {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.search-wrapper {
    position: relative;
}

.search-wrapper .form-control {
    padding-left: 2.5rem;
    height: 48px;
    border-radius: 24px;
    border: 2px solid #e9ecef;
    transition: all 0.2s ease;
}

.search-wrapper .form-control:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.25rem rgba(13,110,253,.15);
}


.quick-filters .btn.active {
    background-color: #0a3d8a;
    color: white;
    box-shadow: 0 2px 4px rgba(13,110,253,0.2);
}

/* Filter Tags */
.active-filter-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    padding: 8px 0;
}

.filter-tag {
    display: inline-flex;
    align-items: center;
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 16px;
    padding: 4px 12px;
    font-size: 0.875rem;
    color: #495057;
    transition: all 0.2s ease;
}

.filter-tag:hover {
    background-color: #e9ecef;
}

.filter-tag .close-btn {
    background: none;
    border: none;
    color: #6c757d;
    font-size: 18px;
    line-height: 1;
    padding: 0 0 0 8px;
    cursor: pointer;
    transition: color 0.2s ease;
}

.filter-tag .close-btn:hover {
    color: #dc3545;
}

/* Advanced Filters */
.advanced-filters-content {
    background-color: #f8f9fa;
    border-radius: 8px;
    padding: 1.5rem;
    margin-top: 1rem;
}

.advanced-filters-content .form-label {
    font-weight: 500;
    color: #495057;
    margin-bottom: 0.5rem;
}

.advanced-filters-content .form-control,
.advanced-filters-content .form-select {
    border: 2px solid #e9ecef;
    border-radius: 6px;
    padding: 0.5rem 1rem;
}

.advanced-filters-content .input-group-text {
    border: 2px solid #e9ecef;
    background-color: #f8f9fa;
}

/* Loading State */
.filter-loading {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255,255,255,0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    display: none;
}

.filter-loading.active {
    display: flex;
}

/* Responsive Adjustments */
@media (max-width: 768px) {
    .quick-filters {
        flex-wrap: wrap;
    }
    
    .quick-filters .btn {
        flex: 1 1 auto;
        min-width: calc(33.333% - 8px);
        margin-bottom: 8px;
    }
    
    .quick-filters .ms-auto {
        width: 100%;
        margin-top: 0.5rem;
        display: flex;
        gap: 0.5rem;
    }
}

.toggle-icon {
    transition: transform 0.3s ease;
}
[aria-expanded="false"] .toggle-icon {
    transform: rotate(180deg);
}
#consolidationDetails {
    transition: all 0.3s ease;
}
.btn-outline-secondary:hover .toggle-icon {
    color: #6c757d;
}

.fs-7 {
    font-size: 0.875rem;
}
.filter-note .card {
    box-shadow: none;
    background-color: rgba(255, 255, 255, 0.5) !important;
}
.filter-note .list-unstyled li {
    margin-bottom: 0.25rem;
}
.filter-note .list-unstyled li:last-child {
    margin-bottom: 0;
}
.filter-note .btn-link {
    text-decoration: none;
}
.filter-note .btn-link:hover {
    background-color: rgba(0, 0, 0, 0.05);
    border-radius: 4px;
}
.filter-note .alert-light {
    background-color: rgba(255, 255, 255, 0.8);
}

.consolidation-section {
    background: #fff;
    border-radius: 12px;
    padding: 1.25rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.04);
}

.info-banner {
    padding: 0.75rem;
    background: rgba(13, 110, 253, 0.04);
    border-radius: 8px;
}

.content-card {
    background: #f8f9fa;
    border-radius: 10px;
    overflow: hidden;
    transition: transform 0.2s;
}

.content-card:hover {
    transform: translateY(-2px);
}

.card-header {
    padding: 0.75rem 1rem;
    background: #fff;
    border-bottom: 1px solid rgba(0,0,0,0.05);
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.card-content {
    padding: 1rem;
}

.detail-item, .format-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem;
    border-radius: 6px;
    margin-bottom: 0.5rem;
    background: #fff;
}

.detail-item:last-child, .format-item:last-child {
    margin-bottom: 0;
}

.detail-item .label {
    color: #6c757d;
    min-width: 100px;
    font-size: 0.875rem;
}

.detail-item .value {
    font-family: 'Roboto Mono', monospace;
    font-size: 0.875rem;
}

.format-item {
    font-size: 0.875rem;
}

.format-item i {
    font-size: 1rem;
}

.badge.rounded-pill {
    padding: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
}

.btn-link:hover {
    opacity: 0.75;
}

@media (max-width: 768px) {
    .consolidation-section {
        padding: 1rem;
    }
    
    .detail-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.25rem;
    }
    
    .detail-item .label {
        min-width: auto;
    }
}

.middleware-disclaimer {
    display: flex;
    gap: 1rem;
    padding: 1rem;
    /* background: linear-gradient(to right, rgba(13, 110, 253, 0.03), rgba(13, 110, 253, 0.01)); */
    border-radius: 8px;
    border: 1px solid rgba(13, 110, 253, 0.1);
    position: relative;
}

.disclaimer-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    flex-shrink: 0;
}

.disclaimer-icon i {
    font-size: 1.25rem;
    color: #0d6efd;
}

.disclaimer-content {
    flex: 1;
}

.disclaimer-content h6 {
    color: #0d6efd;
    font-weight: 600;
    font-size: 0.875rem;
}

.disclaimer-content ul {
    margin-top: 0.25rem;
}

.disclaimer-content ul li {
    color: #6c757d;
    margin-bottom: 0.25rem;
}

.disclaimer-note {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem;
    background: rgba(255, 193, 7, 0.1);
    border-radius: 4px;
    color: #856404;
    font-size: 0.75rem;
}

.disclaimer-info {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem;
    background: rgba(255, 193, 7, 0.1);
    border-radius: 4px;
    color: #084298;
    font-size: 0.75rem;
}

.disclaimer-info i {
    font-size: 0.875rem;
}

.disclaimer-note i {
    font-size: 0.875rem;
}

@media (max-width: 768px) {
    .middleware-disclaimer {
        flex-direction: column;
        align-items: center;
        text-align: center;
        padding: 1rem;
    }

    .disclaimer-content ul {
        text-align: left;
    }

    .disclaimer-note {
        text-align: left;
    }
}
</style>

{% endblock %}

{% block content %}
<div class="container-fluid px-2 px-md-2 px-lg-2">
    <!-- Welcome Card - Full width -->
    <div class="profile-welcome-section mb-4">
        <!-- Welcome Card content -->
        <div class="profile-welcome-card">
            <div class="d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
                <div class="welcome-icon">
                <i class="bi bi-box-arrow-in-right"></i>
                </div>
                <div class="welcome-content">
                    <h3 class="text-xl font-semibold text-white-800 md:text-2xl tracking-tight">Consolidated</h3>
                            <p class="mb-0 cursor-pointer" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-html="true" 
                            title="">
                    Manage and track your consolidated document submissions, including validation and submission status.
                </p>
                <button id="openTutorialBtn" class="btn btn-sm btn-outline-light mt-2">
                    <i class="bi bi-question-circle me-1"></i> How to use this page
                </button>
                </div>
            </div>
            <div class="d-flex align-items-start">
                <!-- Existing datetime section -->
                <div class="welcome-datetime text-end">
                <div class="current-time">
                    <i class="bi bi-clock"></i>
                    <span id="currentTime">00:00:00 AM</span>
                </div>
                <div class="current-date">
                    <i class="bi bi-calendar3"></i>
                    <span id="currentDate">Loading...</span>
                </div>
            </div>
            </div>
        </div>
        </div>
  
        <!-- Content Section - With margins -->
        <div class="content-section">
      <!-- Cards Section -->
      <div class="cards-container">
        <!-- Invoices Card -->
        <div class="info-card invoices-card">
            <div class="card-info">
                <div class="card-icon position-relative">
                    <i class="bi bi-file-earmark-text"></i>
                </div>
                <div class="count-info">
                    <div class="spinner-border text-primary loading-spinner" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <h6 class="total-invoice-count" style="display: none;">0</h6>
                    <span class="text-muted">Total</span>
                </div>
            </div>
            <span class="card-title-new">INVOICES</span>
        </div>

        <!-- Valid Card -->
        <div class="info-card valid-card">
            <div class="card-info">
                <div class="card-icon position-relative">
                    <i class="bi bi-check2-circle"></i>
                </div>
                <div class="count-info">
                    <div class="spinner-border text-success loading-spinner" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <h6 class="total-submitted-count" style="display: none;">0</h6>
                    <span class="text-muted">Total</span>
                </div>
            </div>
            <span class="card-title-new">SUBMITTED</span>
        </div>

        <!-- Invalid Card -->
        <div class="info-card invalid-card">
            <div class="card-info">
                <div class="card-icon position-relative">
                    <i class="bi bi-file-earmark-excel-fill"></i>
                </div>
                <div class="count-info">
                    <div class="spinner-border text-danger loading-spinner" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <h6 class="total-invalid-count" style="display: none;">0</h6>
                    <span class="text-muted">Total</span>
                </div>
            </div>
            <span class="card-title-new">INVALID</span>
        </div>
         
        <!-- PENDING Card -->
        <div class="info-card pending-card">
            <div class="card-info">
                <div class="card-icon position-relative">
                    <i class="bi bi-exclamation-circle-fill"></i>
                </div>
                <div class="count-info">
                    <div class="spinner-border text-warning loading-spinner" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <h6 class="total-queue-value" style="display: none;">0</h6>
                    <span class="text-muted">Total</span>
                </div>
            </div>
            <span class="card-title-new">PENDING</span>
        </div>

              <!-- Invalid Card -->
       <div class="info-card cancelled-card">
        <div class="card-info">
            <div class="card-icon position-relative">
                <i class="bi bi-exclamation-triangle-fill"></i>
            </div>
            <div class="count-info">
                <div class="spinner-border text-warning loading-spinner" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <h6 class="total-cancelled-count" style="display: none;">0</h6>
                <span class="text-muted">Total</span>
            </div>
        </div>
        <span class="card-title-new">CANCELLED</span>
    </div>
     
    </div>

 

    <!-- Statistics Section -->
    <div class="statistics-section mb-4">
      <div class="row">
        <!-- Document Status Chart -->
        <div class="col-md-3">
          <div class="card shadow-sm h-100 ">
            <div class="card-body">
              <h6 class="card-title d-flex align-items-center mb-3 ">
                <i class="bi bi-pie-chart-fill me-2"></i>
                Document Status Distribution
              </h6>
              <div style="height: 200px; position: relative;">
                <canvas id="documentStatusChart"></canvas>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Middleware Disclaimer -->
        <div class="col-md-5">
                <div class="card shadow-sm h-100">
                    <div class="card-body middleware-disclaimer">
                        <div class="disclaimer-icon">
                        <i class="bi bi-arrow-left-right"></i>
                    </div>
                        <div class="disclaimer-content">
                            <h6 class="mb-1">Middleware Service</h6>
                            <div class="info-banner mb-3 d-flex align-items-center">
                                <span class="badge rounded-pill bg-info-subtle text-warning me-2">
                                    <i class="bi bi-info-circle"></i>
                                </span>
                                <small class="text-secondary"><div class="note-badge">
                                    <span>Important Note!</span>
                                </div></small>
                            </div>
    
                            <p class="mb-0 small">We act as a transmission channel between you and LHDN. Our role:</p>
                            <ul class="small mb-0 ps-3 mt-1">
                                <li><i class="bi bi-check-circle me-2"></i>Format validation & data verification before submission</li>
                                <li><i class="bi bi-shield-lock me-2"></i>Secure transmission channel to LHDN's systems</li>
                                <li><i class="bi bi-graph-up me-2"></i>Real-time status tracking through dashboard</li>
                            </ul>
                            <div class="disclaimer-note mt-2">
                                <i class="bi bi-exclamation-circle"></i>
                                <span>Final acceptance and validation are determined by LHDN</span>
                            </div>
                            <div class="disclaimer-info mt-2">
                                <i class="bi bi-link-45deg"></i>
                                <span>Official LHDN SDK Documentation: <a href="https://sdk.hasil.gov.my" target="_blank" class="text-primary">sdk.hasil.gov.my</a></span>
                            </div>
                        </div>
                    </div>
                    </div>
        </div>

        <!-- Processing Time Chart -->
        <div class="col-md-4">
          <div class="card shadow-sm h-100">
            <div class="card-body">
              <h6 class="card-title d-flex align-items-center mb-3">
                <i class="bi bi-bar-chart-fill me-2"></i>
                Submission Success Rate
                <i class="bi bi-info-circle ms-2" data-bs-toggle="tooltip" data-bs-html="true" 
                   title="<div class='p-2'>
                           <strong>How Success Rate is Calculated:</strong><br>
                           <small>Success Rate = (Submitted Documents / Total Documents) × 100<br>
                           Total Documents = Submitted + Invalid + Pending</small>
                         </div>"></i>
              </h6>
              <div class="validation-rate-container" style="height: 200px; position: relative;">
                <div class="validation-stats mb-3">
                  <div class="d-flex justify-content-between align-items-center">
                    <span class="text-muted">Overall Success Rate</span>
                    <span class="fw-bold success-rate" data-bs-toggle="tooltip" data-bs-html="true"
                          title="<div class='p-2'>
                                  <strong>Current Success Rate:</strong> 0%<br>
                                  <small>Based on successfully validated documents out of total submissions</small>
                                </div>">0%</span>
                  </div>
                  <div class="progress" style="height: 25px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%;" 
                         aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                  </div>
                </div>
                <div class="validation-breakdown">
                  <div class="breakdown-item mb-2">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                      <span class="text-muted small">
                        Submitted
                        <i class="bi bi-info-circle-fill ms-1" data-bs-toggle="tooltip" data-bs-html="true"
                           title="<div class='p-2'>
                                   <strong>Submitted Documents:</strong><br>
                                   • Successfully validated by LHDN<br>
                                   • Meets all format requirements<br>
                                   • Ready for submission
                                 </div>"></i>
                      </span>
                      <span class="text-success small">0%</span>
                    </div>
                    <div class="progress" style="height: 10px;">
                      <div class="progress-bar bg-success" role="progressbar" style="width: 0%;" 
                           aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                  </div>
                  <div class="breakdown-item mb-2">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                      <span class="text-muted small">
                        Invalid
                        <i class="bi bi-info-circle-fill ms-1" data-bs-toggle="tooltip" data-bs-html="true"
                           title="<div class='p-2'>
                                   <strong>Invalid Documents:</strong><br>
                                   • Failed LHDN validation<br>
                                   • Format or data issues detected<br>
                                   • Requires correction and resubmission
                                 </div>"></i>
                      </span>
                      <span class="text-danger small">0%</span>
                    </div>
                    <div class="progress" style="height: 10px;">
                      <div class="progress-bar bg-danger" role="progressbar" style="width: 0%;" 
                           aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                  </div>
                  <div class="breakdown-item">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                      <span class="text-muted small">
                        Pending
                        <i class="bi bi-info-circle-fill ms-1" data-bs-toggle="tooltip" data-bs-html="true"
                           title="<div class='p-2'>
                                   <strong>Pending Documents:</strong><br>
                                   • Awaiting LHDN validation<br>
                                   • In processing queue<br>
                                   • May take up to 24 hours
                                 </div>"></i>
                      </span>
                      <span class="text-warning small">0%</span>
                    </div>
                    <div class="progress" style="height: 10px;">
                      <div class="progress-bar bg-warning" role="progressbar" style="width: 0%;" 
                           aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                  </div>
                </div>
                <div class="calculation-note mt-3">
                  <small class="text-muted">
                    <!-- <i class="bi bi-calculator me-1"></i> -->
                    <!-- <span class="loading-text-outbound">Loading statistics...</span> -->
                    <span class="stats-text" style="display: none;">Percentages are calculated based on total document count</span>
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>

   
    </div>
            <!-- Table Section -->
            <div class="table-container-wrapper">
                <div class="table-card">
                    <div class="table-header">
                        <div class="table-header-content">
                            <h2 class="table-title">Outbound Document List</h2>
                            <div class="table-actions">
                                <!-- <button id="exportSelected" class="btn outbound-action-btn submit btn-sm ms-1" disabled>
                                    <i class="bi bi-download me-2"></i>Export Selected
                                </button> -->
                            </div>
                            
                        </div>
                        <div class="disclaimer-note mt-2">
                            <i class="bi bi-exclamation-circle"></i>
                            <span>For a smooth submission process, verify all required fields are complete and accurate on your ERP System Before Submitting to LHDN. </br>
                            <span>Pinnacle e-Invoice Portal performs initial validations for Mandatory fields before proceeding to LHDN submission</span>
                            <a href="/help" class="ms-1 text-decoration-none" target="_blank">
                                <i class="bi bi-question-circle" data-bs-toggle="tooltip" title="Click for help documentation"></i>
                            </a>
                        </div>
                        <div class="disclaimer-note mt-2" style="background: rgba(220, 53, 69, 0.1); color: #842029;">
                            <i class="bi bi-exclamation-triangle"></i>
                            <span><strong>Important Disclaimer:</strong> <br>
                            Our platform provides validation services, but the ultimate responsibility for data accuracy lies with the user. 
                            <br>
                            We are not liable for any consequences, penalties, or issues arising from submission of incomplete, inaccurate or non-compliant data to LHDN.</span>
                        </div>
                        
                    </div>
                    <div class="table-controls">
                        <div class="d-flex align-items-center gap-1">
                            <div class="modern-length">
                                <!-- Length control will be inserted by DataTables -->
                            </div>
                            <div class="modern-search">
                                <!-- Search control will be inserted by DataTables -->
                            </div>
                        </div>
                    </div>
                    <div class="table-body-container">
                        <div class="responsive-table-container">
                            <div class="table-section">
                                <div class="outbound-table-container">
                    <!-- Consolidation Guidelines -->
                        <div class="mt-3 mb-4">
                            <div class="middleware-disclaimer mb-3">
                                <div class="disclaimer-icon">
                                    <i class="bi bi-info-circle-fill text-primary"></i>
                                </div>
                                <div class="disclaimer-content">
                                    <h6 class="mb-0 text-primary fw-bold">Important Information About Consolidation</h6>
                                    <p class="mb-2">This section outlines critical requirements for LHDN e-Invoice consolidation. Please review carefully before proceeding.</p>
                                </div>
                            </div>

                            <div class="d-flex align-items-center justify-content-between mb-3 clickable-header" 
                                 style="cursor: pointer; transition: all 0.2s ease; background: #f8f9fa; padding: 1rem; border-radius: 8px; border: 1px solid #e9ecef;">
                                <div class="d-flex align-items-center">
                                    <span class="badge rounded-pill bg-primary me-2" style="padding: 8px;" data-bs-toggle="tooltip" title="Consolidation allows grouping multiple invoices into a single submission">
                                        <i class="bi bi-boxes"></i>
                                    </span>
                                    <h6 class="mb-0 text-primary fw-bold">LHDN e-Invoice Consolidation Requirements <i class="bi bi-info-circle-fill ms-1 small" data-bs-toggle="tooltip" data-bs-html="true" 
                                        title="<div class='p-2'>
                                            <strong>Before Submitting a Consolidation:</strong><br>
                                            • Must Group multiple invoices together<br>
                                            • Must meet LHDN requirements<br>
                                            • Streamlines submission process</div>">
                                        </i>
                                        </h6>
                                </div>
                                <div class="d-flex align-items-center gap-2">
                                    <a href="https://www.hasil.gov.my/media/uwwehxwq/irbm-e-invoice-specific-guideline.pdf" 
                                       target="_blank" 
                                       class="btn btn-sm btn-link text-primary p-0 d-flex align-items-center hover-effect"
                                       data-bs-toggle="tooltip"
                                       data-bs-html="true"
                                       title="<div class='p-2'>
                                               <strong>LHDN Official Guidelines:</strong><br>
                                               • Review consolidation requirements<br>
                                               • Ensure compliance with LHDN standards<br>
                                               • Understand submission protocols
                                             </div>">
                                        <i class="bi bi-file-pdf fs-5"></i>
                                        <span class="ms-1 small">LHDN Guidelines</span>
                                    </a>
                                    <button class="btn btn-sm btn-link text-primary p-0 d-flex align-items-center toggle-btn" 
                                            type="button" 
                                            data-bs-toggle="collapse" 
                                            data-bs-target="#consolidationDetails" 
                                            aria-expanded="false" 
                                            aria-controls="consolidationDetails"
                                            data-bs-toggle="tooltip"
                                            data-bs-html="true"
                                            title="<div class='p-2'>
                                                    <strong>Consolidation Requirements:</strong><br>
                                                    • View detailed formatting guidelines<br>
                                                    • Check buyer information requirements<br>
                                                    • Review receipt number formatting
                                                  </div>">
                                        <i class="bi bi-chevron-down toggle-icon fs-5"></i>
                                        
                                    </button>
                                </div>
                            </div>

                            <div class="collapse" id="consolidationDetails">
                                <div class="consolidation-content">
                                    <div class="row g-3">
                                        <!-- Buyer's Details -->
                                        <div class="col-md-6">
                                            <div class="content-card h-100" style="border: 1px solid #e9ecef; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                                <div class="card-header bg-light">
                                                    <i class="bi bi-person-badge text-primary"></i>
                                                    <span class="fw-bold">Buyer's Details</span>
                                                </div>
                                                <div class="card-content">
                                                    <div class="detail-item">
                                                        <span class="label">Name</span>
                                                        <span class="value">"General Public"</span>
                                                    </div>
                                                    <div class="detail-item">
                                                        <span class="label">TIN</span>
                                                        <span class="value">"EI00000000010"</span>
                                                    </div>
                                                    <div class="detail-item">
                                                        <span class="label">Registration/ID</span>
                                                        <span class="value">"NA"</span>
                                                    </div>
                                                    <div class="detail-item">
                                                        <span class="label">Other Details</span>
                                                        <span class="value text-muted">Address/Contact/SST: "NA"</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Description Format -->
                                        <div class="col-md-6">
                                            <div class="content-card h-100" style="border: 1px solid #e9ecef; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                                                <div class="card-header bg-light">
                                                    <i class="bi bi-list-check text-primary"></i>
                                                    <span class="fw-bold">Description Format</span>
                                                </div>
                                                <div class="card-content">
                                                    <div class="format-item">
                                                        <i class="bi bi-check2 text-success"></i>
                                                        <span>Summary per receipt as line items (Use Classification Code: 004)</span>
                                                    </div>
                                                    <div class="format-item">
                                                        <i class="bi bi-check2 text-success"></i>
                                                        <span>Continuous receipt number chain</span>
                                                    </div>
                                                    <div class="format-item">
                                                        <i class="bi bi-check2 text-success"></i>
                                                        <span>Branch consolidated submissions</span>
                                                    </div>
                                                    <div class="format-item text-danger">
                                                        <i class="bi bi-exclamation-circle"></i>
                                                        <span>Receipt reference numbers required</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <script>
                            document.addEventListener('DOMContentLoaded', function() {
                                const toggleBtn = document.querySelector('[data-bs-toggle="collapse"]');
                                const clickableHeader = document.querySelector('.clickable-header');
                                
                                // Add hover effect to the entire header
                                clickableHeader.addEventListener('mouseenter', function() {
                                    this.style.transform = 'translateY(-2px)';
                                    this.style.boxShadow = '0 4px 8px rgba(0,0,0,0.1)';
                                });
                                
                                clickableHeader.addEventListener('mouseleave', function() {
                                    this.style.transform = 'translateY(0)';
                                    this.style.boxShadow = 'none';
                                });

                                // Make the entire header trigger the collapse
                                clickableHeader.addEventListener('click', function(e) {
                                    if (!e.target.closest('a')) { // Prevent triggering when clicking the PDF link
                                        toggleBtn.click();
                                    }
                                });

                                toggleBtn.addEventListener('click', function() {
                                    const isCollapsed = this.getAttribute('aria-expanded') === 'false';
                                    this.setAttribute('aria-expanded', isCollapsed);
                                    const icon = this.querySelector('.toggle-icon');
                                    icon.style.transition = 'transform 0.3s ease';
                                    icon.style.transform = isCollapsed ? 'rotate(180deg)' : 'rotate(0)';
                                });

                                // Add hover effect for PDF link
                                const pdfLink = document.querySelector('.hover-effect');
                                pdfLink.addEventListener('mouseenter', function() {
                                    this.style.transform = 'scale(1.1)';
                                    this.style.transition = 'transform 0.2s ease';
                                });
                                
                                pdfLink.addEventListener('mouseleave', function() {
                                    this.style.transform = 'scale(1)';
                                });
                            });
                        </script>
                                    <div>
                                        <!-- Primary Filters Row -->
                                        <div class="row g-3 mb-3">
                                            <!-- Global Search -->
                                            <div class="col-md-4">
                                                <div class="search-wrapper position-relative">
                                                    <i class="bi bi-search position-absolute top-50 start-0 translate-middle-y ms-3 text-muted"></i>
                                                    <input type="text" class="form-control form-control-lg ps-5" id="globalSearch" 
                                                        placeholder="Search documents...">
                                                </div>
                                            </div>
                                            
                                            <!-- Quick Filters -->
                                            <div class="col-md-8">
                                                <div class="quick-filters d-flex gap-2">
                                                    <button class="btn outbound-action-btn submit active" data-filter="all">
                                                        <i class="bi bi-grid-3x3-gap-fill me-1"></i>All
                                                    </button>
                                                    <!-- <button class="btn outbound-action-btn submit" data-filter="submitted">
                                                        <i class="bi bi-check-circle me-1 text-success"></i>Submitted
                                                    </button>
                                                    <button class="btn outbound-action-btn submit" data-filter="invalid">
                                                        <i class="bi bi-x-circle me-1 text-danger"></i>Invalid
                                                    </button>
                                                    
                                                    <button class="btn outbound-action-btn submit" data-filter="cancelled">
                                                        <i class="bi bi-exclamation-triangle-fill me-1 text-warning"></i>Cancelled
                                                    </button>
                                                    <button class="btn outbound-action-btn submit" data-filter="pending">
                                                        <i class="bi bi-clock-history me-1 text-warning"></i>Pending
                                                    </button> -->
                                                    <!-- <div class="ms-auto">
                                                        <button class="btn outbound-action-btn cancel" id="clearFilters" data-bs-toggle="tooltip" title="Clear all filters">
                                                            <i class="bi bi-eraser me-1"></i>Clear
                                                        </button>
                                                        <button class="btn outbound-action-btn submit" data-bs-toggle="collapse" data-bs-target="#advancedFilters">
                                                            <i class="bi bi-sliders me-1"></i>Advanced
                                                        </button>
                                                    </div> -->
                                                </div>
                                            </div>
                                        </div>
                    
                                        <!-- Advanced Filters (Collapsible) -->
                                        <div class="collapse" id="advancedFilters">
                                            <div class="advanced-filters-content border-top pt-3">
                                                <div class="row g-3">
                                                    <!-- Date Range -->
                                                    <div class="col-md-6">
                                                        <label class="form-label d-flex align-items-center">
                                                            <i class="bi bi-calendar-range me-2"></i>Date Range
                                                        </label>
                                                        <div class="input-group">
                                                            <input type="date" class="form-control" id="tableStartDate">
                                                            <span class="input-group-text bg-light">to</span>
                                                            <input type="date" class="form-control" id="tableEndDate">
                                                        </div>
                                                    </div>
                    
                                                    <!-- Amount Range -->
                                                    <div class="col-md-6">
                                                        <label class="form-label d-flex align-items-center">
                                                            <i class="bi bi-currency-dollar me-2"></i>Amount Range
                                                        </label>
                                                        <div class="input-group">
                                                            <input type="number" class="form-control" id="minAmount" placeholder="Min">
                                                            <span class="input-group-text bg-light">to</span>
                                                            <input type="number" class="form-control" id="maxAmount" placeholder="Max">
                                                        </div>
                                                    </div>
                    
                                                    <!-- Company Filter -->
                                                    <div class="col-md-4">
                                                        <label class="form-label d-flex align-items-center">
                                                            <i class="bi bi-building me-2"></i>Company
                                                        </label>
                                                        <input type="text" class="form-control" id="companyFilter" placeholder="Filter by company name">
                                                    </div>
                    
                                                    <!-- Document Type -->
                                                    <div class="col-md-4">
                                                        <label class="form-label d-flex align-items-center">
                                                            <i class="bi bi-file-text me-2"></i>Document Type
                                                        </label>
                                                        <select class="form-select" id="documentTypeFilter">
                                                            <option value="">All Types</option>
                                                            <option value="Invoice">Invoice</option>
                                                            <option value="Credit Note">Credit Note</option>
                                                            <option value="Debit Note">Debit Note</option>
                                                        </select>
                                                    </div>
                    
                                                    <!-- Source -->
                                                    <div class="col-md-4">
                                                        <label class="form-label d-flex align-items-center">
                                                            <i class="bi bi-diagram-2 me-2"></i>Source
                                                            <i class="bi bi-info-circle ms-2" data-bs-toggle="tooltip" data-bs-html="true" 
                                                            title="<div class='tooltip-content'>
                                                                    <div class='tooltip-row'>
                                                                        <i class='bi bi-info-circle'></i>
                                                                        <span><b>LHDN Validation:</b></span>
                                                                    </div>
                                                                    <div class='tooltip-row'>
                                                                        <i class='bi bi-check-circle text-success'></i>
                                                                        <span>Valid: Document passed validation</span>
                                                                    </div>
                                                                    <div class='tooltip-row'>
                                                                        <i class='bi bi-x-circle text-danger'></i>
                                                                        <span>Invalid: Failed validation checks</span>
                                                                    </div>
                                                                    <div class='tooltip-row'>
                                                                        <i class='bi bi-clock-history text-warning'></i>
                                                                        <span>Pending: Awaiting for Submission to LHDN for validation</span>
                                                                    </div>
                                                                </div>"></i>
                                                        </label>
                                                        <select class="form-select" id="sourceFilter">
                                                            <option value="">LHDN</option>
                                                            
                                                        </select>
                                                        <small class="text-muted mt-1 d-block">
                                                            <i class="bi bi-info-circle-fill me-1"></i>
                                                            LHDN responses include validation status and timestamps
                                                        </small>
                                                    </div>
                                                </div>
                    
                                            
                                                <!-- Filter Note -->
                                                <div class="filter-note alert alert-info mt-3" role="alert">
                                                    <i class="bi bi-info-circle me-2"></i>
                                                    <small>
                                                        Use the filters above to narrow down your results. Active filters will appear below as tags that you can easily remove. Click the 'x' on any tag to remove that filter, or use 'Clear all filters' to reset.
                                                    </small>
                                                </div>
                    
                                                <!-- Active Filters Display -->
                                                <div class="active-filters mt-3 pt-3 border-top">
                                                    <div class="d-flex align-items-center">
                                                        <small class="text-muted me-2">Active Filters:</small>
                                                        <div class="active-filter-tags" id="activeFilterTags">
                                                            <!-- Active filter tags will be added here dynamically -->
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                      
                                    </div>
                                    <!-- End of new filter section -->
                                  
                    
                                        <table id="invoiceTable" class="outbound-table-responsive">
                                            <thead>
                                                <tr>
                                                    <th class="outbound-checkbox-column">
                                                        <div class="outbound-checkbox-header">
                                                            <input type="checkbox" class="outbound-checkbox" id="selectAll">
                                                        </div>
                                                    </th>
                                                    <th>#</th>
                                                    <th>INVOICE NO.</th>
                                                    <th>COMPANY</th>
                                                    <th>SUPPLIER</th>
                                                    <th>RECEIVER</th>
                                                    <th>DATE</th>
                                                    <th>INV. DATE INFO</th>
                                                    <th>STATUS</th>
                                                    <th>SOURCE</th>
                                                    <th>TOTAL AMOUNT</th>
                                                    <th class="outbound-action-column">ACTION</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                    
                                                </tbody>
                                            </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Loading Overlay -->
                        <div id="tableLoadingOverlay" class="table-loading-overlay d-none">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Fetching documents...</p>
                        </div>
                    </div>
                    
                    
       
                    <div class="table-footer">
                        <div class="pagination-container">
                            <!-- Pagination will be inserted by DataTables -->
                        </div>
                    </div>
                </div>
            </div>
        
        
    </div>
    </div>
</div>

<!-- Modal for Validation Results -->
<div class="modal fade lhdn-validation-modal" id="validationResultsModal" tabindex="-1" aria-labelledby="validationResultsModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="validationResultsModalLabel">
          <i class="bi bi-shield-check"></i>
          Validation Results
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="lhdn-validation-content">
          <div class="lhdn-validation-steps" id="validationResults">
            <!-- Validation results will be populated here -->
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Validation Error Modal -->
<div class="modal fade lhdn-validation-modal" id="validationErrorModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-shield-x"></i>
                    Validation Error
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="lhdn-validation-content">
                    <div class="lhdn-validation-steps" id="validationErrorList">
                        <!-- Validation errors will be populated here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- Alert Template -->
<template id="alertTemplate">
    <div class="custom-alert">
        <i class="alert-icon"></i>
        <div class="alert-content">
            <div class="alert-title"></div>
            <div class="alert-message"></div>
        </div>
        <button class="close-btn" onclick="this.parentElement.remove()">×</button>
    </div>
</template>

<!-- Add Consolidated Submit Modal -->
<div class="modal fade" id="consolidatedSubmitModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-file-earmark-arrow-up"></i>
                    Submit Bulk Documents
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- User Guidance Section -->
                <div class="user-guidance mb-4">
                    <div class="guidance-header">
                        <i class="bi bi-info-circle"></i>
                        <h6>How to Submit Multiple Documents</h6>
                    </div>
                    <div class="guidance-steps">
                        <div class="guidance-step">
                            <span class="step-number">1</span>
                            <span class="step-text">Select documents from the table (ensure all documents comply with LHDN format)</span>
                        </div>
                        <div class="guidance-step">
                            <span class="step-number">2</span>
                            <span class="step-text">Verify selected documents have valid TIN numbers and company details</span>
                        </div>
                        <div class="guidance-step">
                            <span class="step-number">3</span>
                            <span class="step-text">Choose LHDN version (v1.0 for standard submission)</span>
                        </div>
                        <div class="guidance-step">
                            <span class="step-number">4</span>
                            <span class="step-text">Review and submit documents for batch processing</span>
                        </div>
                    </div>
                    <div class="guidance-requirements mt-3">
                        <h6 class="requirements-title">
                            <i class="bi bi-shield-check"></i>
                            LHDN Compliance Requirements
                        </h6>
                        <ul class="requirements-list">
                            <li>
                                <i class="bi bi-check-circle"></i>
                                All documents must have valid Tax Identification Numbers (TIN)
                            </li>
                            <li>
                                <i class="bi bi-check-circle"></i>
                                Company details must match LHDN registered information
                            </li>
                            <li>
                                <i class="bi bi-check-circle"></i>
                                Documents must be in the correct format (JSON/XML)
                            </li>
                            <li>
                                <i class="bi bi-check-circle"></i>
                                Each document must pass LHDN schema validation
                            </li>
                        </ul>
                    </div>
                    <div class="guidance-note">
                        <i class="bi bi-exclamation-circle"></i>
                        <span>Important: Documents will be processed individually. All documents must meet LHDN requirements for successful submission.</span>
                    </div>
                </div>

                <div class="selected-docs-container">
                    <h6>Selected Documents</h6>
                    <div id="selectedDocsList" class="selected-docs-list">
                        <!-- Selected documents will be listed here -->
                    </div>
                </div>
                <div class="submission-options">
                    <div class="mb-0">
                        <label class="form-label">LHDN Version</label>
                        <select class="form-select" id="lhdnVersion">
                            <option value="1.0">Version 1.0</option>
                            <option value="1.1" disabled>Version 1.1 (with Digital Signature) COMING SOON</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn outbound-action-btn cancel" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn outbound-action-btn submit" id="submitConsolidatedBtn">
                    Submit Documents
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Progress Modal -->
<div class="modal fade" id="submissionProgressModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Submission Progress</h5>
            </div>
            <div class="modal-body">
                <div id="submissionProgress">
                    <!-- Progress will be shown here -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Tutorial Modal -->
<div class="guided-tour-overlay" id="guidedTourOverlay"></div>
<div class="guided-tour-tooltip" id="guidedTourTooltip">
    <div class="tooltip-header">
        <div class="tooltip-step-indicator">
            <span id="currentStepIndicator">1</span>/<span id="totalStepsIndicator">6</span>
        </div>
        <button type="button" class="tooltip-close-btn" id="closeTourBtn">
            <i class="bi bi-x"></i>
        </button>
    </div>
    <div class="tooltip-body">
        <h4 class="tooltip-title" id="tooltipTitle">Welcome to Outbound</h4>
        <div class="tooltip-content" id="tooltipContent">
            <!-- Content will be dynamically inserted -->
        </div>
    </div>
    <div class="tooltip-progress">
        <div class="progress">
            <div class="progress-bar" id="tourProgressBar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        <div class="step-indicators d-flex justify-content-between px-3 mt-2" id="stepIndicators">
            <!-- Step indicators will be dynamically inserted -->
        </div>
    </div>
    <div class="tooltip-footer">
        <button type="button" class="tooltip-btn tooltip-btn-prev" id="prevStepBtn" disabled>
            <i class="bi bi-arrow-left"></i>
        </button>
        <button type="button" class="tooltip-btn tooltip-btn-skip" id="skipTourBtn">
            Skip
        </button>
        <button type="button" class="tooltip-btn tooltip-btn-next" id="nextStepBtn">
            Next <i class="bi bi-arrow-right"></i>
        </button>
    </div>
</div>

{% endblock %} 
{% block scripts %}
<script src="/assets/js/modules/excel/outbound-excel.js"></script>
<script src="/assets/js/modules/tutorial/guided-tour.js"></script>
<script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize all tooltips
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.forEach(tooltipTriggerEl => {
        new bootstrap.Tooltip(tooltipTriggerEl, {
            html: true,
            container: 'body'
        });
    });

    // Add event listener for the tutorial button
    document.getElementById('openTutorialBtn')?.addEventListener('click', function() {
        if (window.tourManager) {
            window.tourManager.startTour();
        }
    });

    // Success alert
    window.showSuccessAlert = function(message) {
        showAlert('success', 'Success', message);
    };

    // Error alert
    window.showErrorAlert = function(message) {
        showAlert('error', 'Error', message);
    };

    // Warning alert
    window.showWarningAlert = function(message) {
        showAlert('warning', 'Warning', message);
    };

    // Example of showing validation errors
    window.showValidationErrorModal = function(errors) {
        showValidationErrors(errors);
    };
});
</script>
{% endblock %} 